<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sign up</title>
    <!-- Bulma 自訂 -->
    <link rel="stylesheet" href="../asset/css/my-bulma.css" />
    <!-- 自定義 CSS -->
    <link rel="stylesheet" href="../asset/css/index-style.css" />
    <!-- Font Awesome -->
    <script
      src="https://kit.fontawesome.com/0548105e54.js"
      crossorigin="anonymous"
    ></script>
    <!-- jquery -->
    <script src="../asset/js/jquery-3.6.3.min.js"></script>
    <!-- 共用元件 -->
    <script
      defer
      src="../asset/js/components.js?ver=2"
      type="text/javascript"
    ></script>
    <!-- 初始化 Bulma -->
    <script defer src="../asset/js/bulma-init.js"></script>
  </head>
  <body>
    <header-component></header-component>
    <div class="columns">
      <div class="column"></div>
      <div class="column is-half">
        <section class="section">
          <!-- 標題 -->
          <div class="content has-text-centered"><h1>註冊</h1></div>
          <!-- 表單 -->
          <form class="box" action="#" method="post" id="form-signup">
            <div class="content msg"><p>請填寫以下欄位</p></div>
            <div class="field account">
              <label class="label" for="input-account">帳號</label>
              <div class="control">
                <input
                  class="input"
                  type="email"
                  name="account"
                  placeholder="alexyang@email.com"
                  id="input-account"
                />
              </div>
            </div>

            <div class="field password">
              <label class="label" for="input-password">密碼</label>
              <div class="control">
                <input
                  class="input"
                  type="password"
                  name="password"
                  placeholder="********"
                  id="input-password"
                />
              </div>
            </div>

            <div class="field username">
              <label class="label" for="input-username">暱稱</label>
              <div class="control">
                <input
                  class="input"
                  type="text"
                  name="username"
                  placeholder="暱稱"
                  id="input-username"
                />
              </div>
            </div>

            <div class="field gender">
              <label class="label" for="input-gender">性別</label>
              <div class="control">
                <label><input type="radio" name="gender" value="男" />男</label>
                <label><input type="radio" name="gender" value="女" />女</label>
                <label
                  ><input type="radio" name="gender" value="其他" />其他</label
                >
              </div>
            </div>

            <div class="field birthday">
              <label class="label" for="input-birthday">生日</label>
              <div class="control">
                <input
                  class="input"
                  type="date"
                  name="birthday"
                  id="input-birthday"
                  min="1900-01-01"
                />
              </div>
            </div>

            <!-- 表單按鈕 -->
            <div class="field is-grouped">
              <div class="control">
                <button
                  class="button is-primary has-text-centered"
                  type="button"
                  id="btn-signup"
                >
                  註冊
                </button>
              </div>
              <div class="control">
                <button
                  class="button is-light has-text-centered"
                  type="button"
                  id="btn-back"
                >
                  回到首頁
                </button>
              </div>
            </div>
          </form>
        </section>
      </div>
      <div class="column"></div>
    </div>
    <footer-component></footer-component>
    <script src="../asset/js/checkLogin.js"></script>
    <script>
      $(function () {
        const account = $("input#input-account");
        const password = $("input#input-password");
        const username = $("input#input-username");
        const birth = document.querySelector("#input-birthday");

        birth.max = new Date(
          new Date().getTime() - new Date().getTimezoneOffset() * 60000
        )
          .toISOString()
          .split("T")[0];
        birth.value = new Date(
          new Date().getTime() - new Date().getTimezoneOffset() * 60000
        )
          .toISOString()
          .split("T")[0];
        $("button#btn-signup").on("click", function () {
          var gender = $("input[type=radio][name=gender]:checked");
          console.log(gender);
          // console.log(birth);
          fetch("register", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              account: account.val(),
              password: password.val(),
              username: username.val(),
              gender: gender.val(),
              birthday: birth.value,
            }),
          }).then((resp) => {
            resp.json().then((body) => {
              if (body.successful == false) {
                let msg = body.message;
                $("div.msg").text(msg);
                $("div.msg").css("color", "red");
                $("html,body").animate({ scrollTop: 0 }, "fast");
              } else {
                alert(
                  `successful: ${body.successful} message: ${body.message}`
                );

                location.href = location.origin + "/lazy-trip-back/index.html";
              }
            });
          });
        });
      });
    </script>
  </body>
</html>
