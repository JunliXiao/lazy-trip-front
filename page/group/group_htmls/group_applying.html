<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LazyTrip.io | 揪團</title>
    <!-- Bulma 自訂 -->
    <link rel="stylesheet" href="../../../asset/css/my-bulma.css" />
    <!-- 自定義 CSS -->
    <link rel="stylesheet" href="../../../asset/css/index-style.css" />
    <!-- Font Awesome -->
    <script
      src="https://kit.fontawesome.com/0548105e54.js"
      crossorigin="anonymous"
    ></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <!-- 共用元件 -->
    <script
      defer
      src="../../../asset/js/components.js"
      type="text/javascript"
    ></script>

    <!-- 初始化 Bulma -->
    <script defer src="../../../asset/js/bulma-init.js"></script>
    <!--GroupCss-->
    <link rel="stylesheet" href=".././css/group.css" />
  </head>
  <body>
    <!-- 導覽列 -->
    <header-component></header-component>

    <!-- 內容 -->
    <div class="columns">
      <div class="column"></div>
      <div class="column is-8">
        <section class="section">
          <!-- 標題 -->
          <div class="content has-text-centered"><h1>申請中成員</h1></div>
          <div class="content has-text-centered"><h3>揪團名</h3></div>
          <!-- 表單 -->
          <form class="box" action="#" method="post" id="form_gp_setting">
            <!--新增成員-->
            <div class="field">
              <label class="label" for="gp_name">申請中成員</label>
            </div>
            <div id="mem_to_add">
              <div class="field is_applying">
                <label>
                  <input type="checkbox" name="to_add_mems" class="mems" />
                  <img class="img_member_list" src="./test.png" />asdsadsa1
                  <ul>
                    <li>
                      <label style="font-size: 16px">簡介:</label>
                      <label class="info"
                        >簡介20個字簡介簡介簡介簡介簡介簡介簡介簡</label
                      >
                    </li>
                    <li>
                      <label style="font-size: 16px">特殊需求:</label>
                      <label class="spe_need"
                        >特殊需求20個字簡介簡介簡介簡介簡介簡介簡</label
                      >
                    </li>
                  </ul>
                </label>
              </div>
              <div class="field is_applying">
                <label>
                  <input type="checkbox" name="to_add_mems" class="mems" />
                  <img class="img_member_list" src="./test.png" />asdsadsa1
                  <ul>
                    <li>
                      <label style="font-size: 16px">簡介:</label>
                      <label class="info"
                        >簡介20個字簡介簡介簡介簡介簡介簡介簡介簡</label
                      >
                    </li>
                    <li>
                      <label style="font-size: 16px">特殊需求:</label>
                      <label class="spe_need"
                        >特殊需求20個字簡介簡介簡介簡介簡介簡介簡</label
                      >
                    </li>
                  </ul>
                </label>
              </div>
              <div class="field is_applying">
                <label>
                  <input type="checkbox" name="to_add_mems" class="mems" />
                  <img class="img_member_list" src="./test.png" />asdsadsa1
                  <ul>
                    <li>
                      <label style="font-size: 16px">簡介:</label>
                      <label class="info"
                        >簡介20個字簡介簡介簡介簡介簡介簡介簡介簡</label
                      >
                    </li>
                    <li>
                      <label style="font-size: 16px">特殊需求:</label>
                      <label class="spe_need"
                        >特殊需求20個字簡介簡介簡介簡介簡介簡介簡</label
                      >
                    </li>
                  </ul>
                </label>
              </div>
            </div>
            <!-- 表單按鈕 -->
            <div class="field is-grouped">
              <div class="control">
                <button
                  class="button is-primary has-text-centered"
                  type="submit"
                  id="btn_gp_amend"
                >
                  新增
                </button>
              </div>
              <div class="control">
                <button
                  class="button is-info is-light has-text-centered"
                  type="button"
                  id="btn_gp_del"
                >
                  拒絕
                </button>
              </div>
            </div>
          </form>
        </section>
      </div>
      <div class="column"></div>
    </div>
    <!-- 頁尾 -->
    <footer-component></footer-component>
    <script>
      window.onload = function () {
        let gp_amend_el = document.getElementById("btn_gp_amend");
        let set_check_join = document.getElementById("check_join");
        let set_any_join = document.getElementById("any_join");
        let btn_amend = document.getElementById("btn_uncheckmem");
        let url1 =
          "http://localhost:8080/lazy-trip-back/group?action=getOneGroup&groupid=";
        // console.log(url1 + gpid);
        let group_manager_id;
        let getUrlString = location.href;
        var url = new URL(getUrlString);
        let gpid = url.searchParams.get("groupid"); // 回傳 groupid

        //加載時的fetch，得到使用者
        fetch(
          "http://localhost:8080/lazy-trip-back/group?action=getUsingMember"
        )
          .then((response) => response.json())
          .then((data) => {
            console.log(data);
            user_id = data.id;
          })
          .then(
            //加載時的fetch，取得群組資訊
            fetch(url1 + gpid)
              .then((response) => response.json())
              .then((data) => {
                console.log(data);
                //$("#gp_main_gpname").html(data[0].groupname);
                group_manager_id = data[0].memberid;
                $("#gp_name").val(data[0].groupname);
                $("#gp_mem_num").val(data[0].groupmembercount);
                // console.log(data.ifjoingroupdirectly);
                if (data[0].ifjoingroupdirectly == "1") {
                  $("#check_join").attr("checked", true);
                } else if (data[0].ifjoingroupdirectly == "2") {
                  $("#any_join").attr("checked", true);
                }
                console.log("權限:" + group_manager_id);
                console.log("使用者" + user_id);

                //驗證使用者權限
                if (!(user_id === group_manager_id)) {
                  alert("沒有權限!");
                  history.back();
                }
              })
              .catch((error) => console.log("error", error))
          );

        gp_amend_el.onclick = (e) => {
          if ($("input.mems:checked").length != 0) {
            alert("新增成功!");
            //預計放入直接前往該揪團主頁
          } else {
            alert("請確認要新增的成員!");
            e.preventDefault();
          }
        };

        $("#btn_gp_del").on("click", function (e) {
          if ($("input.mems:checked").length != 0) {
            var r = confirm("確定要拒絕以上成員嗎");
            if (r == true) {
              alert("拒絕成功!");
            } else {
              e.preventDefault();
            }
          } else {
            alert("請確認要拒絕的成員!");
            e.preventDefault();
          }
        });

        //限制選5筆
        $("input[type=checkbox]").click(function () {
          $("input[name='to_add_mems']").attr("disabled", true);
          if ($("input[name='to_add_mems']:checked").length >= 5) {
            $("input[name='to_add_mems']:checked").attr("disabled", false);
          } else {
            $("input[name='to_add_mems']").attr("disabled", false);
          }
        });
      };
    </script>
  </body>
</html>
