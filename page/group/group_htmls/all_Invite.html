<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LazyTrip.io | 揪團</title>
    <!-- Bulma 自訂 -->
    <link rel="stylesheet" href="../../../asset/css/my-bulma.css" />
    <!-- 自定義 CSS -->
    <link rel="stylesheet" href="../../../asset/css/index-style.css" />
    <!-- Font Awesome -->
    <script
      src="https://kit.fontawesome.com/0548105e54.js"
      crossorigin="anonymous"
    ></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <!-- 共用元件 -->
    <script
      defer
      src="../../../asset/js/components.js"
      type="text/javascript"
    ></script>

    <!-- 初始化 Bulma -->
    <script defer src="../../../asset/js/bulma-init.js"></script>
    <!--GroupCss-->
    <link rel="stylesheet" href=".././css/group.css" />
  </head>
  <body>
    <!-- 導覽列 -->
    <header-component></header-component>

    <!-- 內容 -->
    <div class="columns">
      <div class="column"></div>
      <div class="column is-8">
        <section class="section">
          <!-- 標題 -->
          <div class="content has-text-centered">
            <h1>揪團邀請列表</h1>
          </div>
          <!-- 表單 -->
          <form class="box" action="#" method="post" id="form_gp_setting">
            <!--邀請中揪團列表-->

            <div id="mem_to_add">
              <!-- <div class="field is_applying">
                <label>
                  <input type="radio" name="to_add_gps" class="mems" />
                  揪團名團名
                  <ul>
                    <li>
                      <label style="font-size: 16px">當前行程:</label>
                      <label class="info">行程行程行程行程</label>
                    </li>
                    <li>
                      <label style="font-size: 16px">人數上限:</label>
                      <label class="spe_need">上限</label>
                    </li>
                  </ul>
                </label>
              </div> -->
            </div>
            <!-- 表單按鈕 -->
            <div class="field is-grouped">
              <div class="control">
                <button
                  class="button is-primary has-text-centered"
                  type="submit"
                  id="btn_gp_amend"
                >
                  接受
                </button>
              </div>
              <div class="control">
                <button
                  class="button is-info is-light has-text-centered"
                  type="button"
                  id="btn_gp_del"
                >
                  拒絕
                </button>
              </div>
            </div>
          </form>
        </section>
      </div>
      <div class="column"></div>
    </div>
    <!-- 頁尾 -->
    <footer-component></footer-component>
    <script>
      window.onload = function () {
        let gp_amend_el = document.getElementById("btn_gp_amend");
        let set_check_join = document.getElementById("check_join");
        let set_any_join = document.getElementById("any_join");
        let btn_amend = document.getElementById("btn_uncheckmem");
        let user_id;
        let list_invite_html;
        //得到使用者
        fetch(
          "http://localhost:8080/lazy-trip-back/group?action=getUsingMember"
        )
          .then((response) => response.json())
          .then((data) => {
            // console.log(data);
            user_id = data.id;

            //取得資料
            fetch(
              "http://localhost:8080/lazy-trip-back/groupmembers?action=getAllInvite"
            )
              .then((response) => response.json())
              .then((result) => {
                console.log(result);
                $.each(result, function (index, item) {
                  console.log(item.groupVO.groupname);
                  list_invite_html = `<div class="field is_applying">
                <label>
                  <input
                    type="radio"
                    name="to_add_gps"
                    class="mems"
                    value="${item.groupmember}"
                  />
                  ${item.groupVO.groupname}
                  <ul>
                    <li>
                      <label style="font-size: 16px">當前行程:</label>
                      <label class="info">${item.groupVO.tourVO.tourTitle}</label>
                    </li>
                    <li>
                      <label style="font-size: 16px">人數上限:</label>
                      <label class="spe_need">${item.groupVO.groupmembercount}</label>
                    </li>
                  </ul>
                </label>
              </div>`;
                });
                $("#mem_to_add").html("");
                $("#mem_to_add").html(list_invite_html);
              })
              .catch((error) => console.log("error", error));
          });

        gp_amend_el.onclick = (e) => {
          if ($("input.mems:checked").length != 0) {
            e.preventDefault();

            //預計放入直接前往該揪團主頁
          } else {
            alert("請確認要操作的揪團邀請!");
            e.preventDefault();
          }
        };

        $("#btn_gp_del").on("click", function (e) {
          if ($("input.mems:checked").length != 0) {
            var r = confirm("確定要拒絕此揪團邀請嗎");
            if (r == true) {
              alert("拒絕成功!");
            } else {
              e.preventDefault();
            }
          } else {
            alert("請確認要操作的揪團!");
            e.preventDefault();
          }
        });

        //限制選5筆
        $("input[type=checkbox]").click(function () {
          $("input[name='to_add_gps']").attr("disabled", true);
          if ($("input[name='to_add_gps']:checked").length >= 5) {
            $("input[name='to_add_gps']:checked").attr("disabled", false);
          } else {
            $("input[name='to_add_gps']").attr("disabled", false);
          }
        });
      };
    </script>
  </body>
</html>
