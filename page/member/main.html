<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sign In</title>
    <!-- Bulma 自訂 -->
    <link rel="stylesheet" href="../../asset/css/my-bulma.css" />
    <!-- 自定義 CSS -->
    <link rel="stylesheet" href="../../asset/css/index-style.css" />
    <!-- Font Awesome -->
    <script
      src="https://kit.fontawesome.com/0548105e54.js"
      crossorigin="anonymous"
    ></script>
    <!-- jquery -->
    <script src="../../asset/js/jquery-3.6.3.min.js"></script>
    <!-- 共用元件 -->
    <script
      defer
      src="../../asset/js/components.js?ver=3"
      type="text/javascript"
    ></script>
    <!-- 初始化 Bulma -->
    <script defer src="../../asset/js/bulma-init.js?ver=2"></script>
    <style>
      div.mem_img > img {
        border-radius: 100%;
        width: 100px;
        height: 100px;
      }
      span.mem_acc {
        text-align: start;
      }
      span.gear {
        border: 1px solid black;
      }
    </style>
  </head>
  <body>
    <header-component></header-component>

    <section class="section mt-6">
      <div class="container mb-3 is-max-widescreen">
        <div class="tile is-ancestor">
          <div class="tile is-parent box is-12">
            <div class="tile is-child is-5">
              <div class="mem_img">
                <span class="mem_username"></span>
              </div>

              <div class="tabs is-medium mt-4">
                <ul>
                  <li class="is-active"><a class="tabs">動態消息</a></li>
                  <li><a class="tabs">評論</a></li>
                  <li><a class="tabs">相片</a></li>
                  <li><a class="tabs">旅程</a></li>
                </ul>
              </div>
            </div>
            <div class="tile is-child"></div>
            <div class="tile is-child is-2">
              <button
                class="button btn_edit js-modal-trigger"
                data-target="modal-js-example"
              >
                <span class="icon">
                  <i class="fa-solid fa-gear"></i>
                </span>
                <span>編輯個人資料</span>
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="columns">
        <div class="column is-one-quarter">
          <div class="card mb-3">
            <div class="card-content">
              <div class="content intro">
                <div class="">簡介</div>
              </div>
              <button class="button">
                <span class="icon">
                  <i class="fa-solid fa-gear"></i>
                </span>
                <span>編輯簡介</span>
              </button>
            </div>
          </div>
          <div class="card mb-3">
            <div class="card-content">
              <!-- <div class="media">
                <div class="media-left">
                  <figure class="image is-48x48">
                    <img
                      src="https://bulma.io/images/placeholders/96x96.png"
                      alt="Placeholder image"
                    />
                  </figure>
                </div>
                <div class="media-content">
                  <p class="title is-4">John Smith</p>
                  <p class="subtitle is-6">@johnsmith</p>
                </div>
              </div> -->

              <div class="content ml-4">
                <button class="button">
                  <span class="icon">
                    <i class="fa-solid fa-image"></i>
                  </span>
                  <span>分享圖片</span>
                </button>
              </div>
              <div class="content ml-4">
                <button class="button">
                  <span class="icon">
                    <i class="fa-solid fa-pen-to-square"></i>
                  </span>
                  <span>撰寫評論</span>
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="column is-9">
          <div class="box">
            m dolor sit amet, consectetur adipiscing elit. Etiam semper diam at
            erat pulvinar, at pulvinar felis blandit. Vestibulum volutpat tellus
            diam, consequat gravida libero rhoncus ut. Morbi maximus, leo sit
            amet vehicu
          </div>
          <div class="box">PPPPPP</div>
          <div class="box">PPPPPP</div>
          <div class="box">PPPPPP</div>
          <div class="box">PPPPPP</div>
          <div class="box">PPPPPP</div>
          <div class="box">PPPPPP</div>
          <div class="box">PPPPPP</div>
        </div>
      </div>
    </section>

    <div id="modal-js-example" class="modal">
      <div class="modal-background"></div>
      <div class="modal-card">
        <header class="modal-card-head">
          <p class="modal-card-title">Modal title</p>
          <button class="delete" aria-label="close"></button>
        </header>
        <section class="modal-card-body">
          <div class="field">
            <label class="label" for="input-name">姓名</label>
            <div class="control">
              <input
                class="input"
                type="text"
                name="name"
                placeholder=""
                id="input-name"
              />
            </div>
          </div>

          <div class="field">
            <label class="label" for="input-phone">電話</label>
            <div class="control">
              <input
                class="input"
                type="number"
                name="phone"
                placeholder="0912345678"
                id="input-phone"
              />
            </div>
          </div>
          <div class="field">
            <label class="label" for="input-address">住址</label>
            <div class="control">
              <input
                class="input"
                type="text"
                name="address"
                placeholder="OO市XX區YY路N巷M號"
                id="input-address"
              />
            </div>
          </div>

          <div class="field username">
            <label class="label" for="input-username">暱稱</label>
            <div class="control">
              <input
                class="input"
                type="text"
                name="username"
                placeholder="暱稱"
                id="input-username"
              />
            </div>
          </div>

          <div class="field gender">
            <label class="label" for="input-gender">性別</label>
            <div class="control">
              <label><input type="radio" name="gender" value="男" />男</label>
              <label><input type="radio" name="gender" value="女" />女</label>
              <label
                ><input type="radio" name="gender" value="其他" />其他</label
              >
            </div>
          </div>

          <div class="field birthday">
            <label class="label" for="input-birthday">生日</label>
            <div class="control">
              <input
                class="input"
                type="date"
                name="birthday"
                id="input-birthday"
                min="1900-01-01"
              />
            </div>
          </div>

          <!-- Content ... -->
        </section>
        <footer class="modal-card-foot">
          <button class="button is-success">保存</button>
          <button class="button">取消</button>
        </footer>
      </div>
    </div>

    <footer-component></footer-component>
    <script src="../../asset/js/checkLogin.js"></script>
    <!-- <script src="js/main.js"></script> -->
    <script>
      $(function () {
        const mem_username = $("span.mem_username");
        const img = $("div.mem_img");

        const name = $("input#input-name");
        const phone = $("input#input-phone");
        const address = $("input#input-address");
        const username = $("input#input-username");
        const birth = document.getElementById("input-birthday");

        birth.max = new Date(
          new Date().getTime() - new Date().getTimezoneOffset() * 60000
        )
          .toISOString()
          .split("T")[0];
        // ------------------------------

        function getCookie(name) {
          const value = `; ${document.cookie}`;
          const parts = value.split(`; ${name}=`);
          if (parts.length === 2) return parts.pop().split(";").shift();
        }

        // ---------------------------------

        $(document).on("click", "a.tabs", function () {
          $(this).closest("ul").find("li").removeClass("is-active");
          $(this).closest("li").addClass("is-active");
        });

        $("button.is-success").on("click", function () {
          let gender = $("input[type=radio][name=gender]:checked");

          fetch("save", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              id: parseInt(getCookie("memId")),
              name: name.val(),
              phone: phone.val(),
              address: address.val(),
              username: username.val(),
              gender: gender.val(),
              birthday: birth.value,
            }),
          })
            .then((resp) => resp.json())
            .then((body) => {
              alert(`successful: ${body.successful} message: ${body.message}`);
              if (body.successful == true) {
                location.assign("main.html");
              }
            });
        });

        fetch(`find?id=${getCookie("memId")}`)
          .then((resp) => resp.json())
          .then((member) => {
            let mem_img;
            if (member.hasOwnProperty("imgBase64Str")) {
              mem_img = `<img src="data:image/*;base64,${member.imgBase64Str}" >`;
            } else {
              mem_img = `<img src="../../asset/img/default.png" >`;
            }

            img.prepend(mem_img);
            mem_username.text(member.username);

            $("input[name=gender][value=" + member.gender + "]").prop(
              "checked",
              true
            );
            name.val(member.name);
            phone.val(member.phone);
            address.val(member.address);
            username.val(member.username);
            birth.value = `${member.birthday}`;
          });
      });
    </script>
  </body>
</html>
